(function(){var e={3225:function(e,t,o){"use strict";var n=o(9726);function i(e,t,o,i,s,a){const r=(0,n.g2)("ThingsEditor");return(0,n.uX)(),(0,n.Wv)(r)}const s={class:"main-container"},a={class:"editor-container"},r={class:"editor-toolbar"},l={class:"toolbar-left"},c={class:"control"},d={class:"control"},p={class:"toolbar-center"},u={class:"control"},m={class:"control"},h={class:"toolbar-right"},v={class:"control",style:{width:"150px"}},g={key:0,class:"save-timer"},f={class:"editor-toolbar"},b={class:"toolbar-left"},y={class:"control"},x={class:"control"},w={class:"toolbar-right"},S={key:0,class:"control",style:{width:"300px","text-align":"right",color:"#f39c12"}},k={class:"control"},C={ref:"viewerContainer",class:"viewer","aria-label":"Document preview"};function T(e,t,o,i,T,P){return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",a,[(0,n.Lk)("div",r,[(0,n.Lk)("div",l,[(0,n.Lk)("div",c,[t[10]||(t[10]=(0,n.Lk)("label",{class:"control-label"},"Type",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>T.documentType=e),class:"control-select"},[...t[9]||(t[9]=[(0,n.Lk)("option",{value:"info"},"Info",-1),(0,n.Lk)("option",{value:"lore"},"Lore",-1)])],512),[[n.u1,T.documentType]])]),(0,n.Lk)("div",d,[t[12]||(t[12]=(0,n.Lk)("label",{class:"control-label"},"Columns",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.columnCount=e),class:"control-select"},[...t[11]||(t[11]=[(0,n.Lk)("option",{value:"1"},"1",-1),(0,n.Lk)("option",{value:"2"},"2",-1),(0,n.Lk)("option",{value:"3"},"3",-1)])],512),[[n.u1,T.columnCount]])])]),(0,n.Lk)("div",p,[(0,n.Lk)("div",u,[(0,n.Lk)("button",{class:"btn secondary",onClick:t[2]||(t[2]=(...e)=>P.loadState&&P.loadState(...e))},"Load")]),(0,n.Lk)("div",m,[(0,n.Lk)("button",{class:"btn primary",onClick:t[3]||(t[3]=(...e)=>P.saveState&&P.saveState(...e))},"Save")])]),(0,n.Lk)("div",h,[(0,n.Lk)("div",v,[T.isSaving?((0,n.uX)(),(0,n.CE)("span",g,"Auto-saving...")):(0,n.Q3)("",!0)]),(0,n.Lk)("button",{class:"btn primary",onClick:t[4]||(t[4]=(...e)=>P.exportImage&&P.exportImage(...e))},"Export Images")])]),(0,n.Lk)("div",f,[(0,n.Lk)("div",b,[(0,n.Lk)("div",y,[t[14]||(t[14]=(0,n.Lk)("label",{class:"control-label"},[(0,n.Lk)("i",{class:"ra ra-hammer"}),(0,n.eW)(" Insert Item")],-1)),(0,n.Lk)("select",{onChange:t[5]||(t[5]=(...e)=>P.onItemDropdownSelect&&P.onItemDropdownSelect(...e)),class:"control-select"},[...t[13]||(t[13]=[(0,n.Fv)('<option disabled selected value="">Select Item Type...</option><option value="equipment">Blank Equipment Template</option><option value="sample_javelin">Sample: &quot;JAVELIN OF THE SKIES&quot;</option><option value="sample_specialist_table">Sample: Specialist Talent Table</option><option value="sample_spell">Sample: Spell Template</option>',5)])],32)]),(0,n.Lk)("div",x,[t[16]||(t[16]=(0,n.Lk)("label",{class:"control-label"},[(0,n.Lk)("i",{class:"ra ra-book"}),(0,n.eW)(" Insert Page")],-1)),(0,n.Lk)("select",{onChange:t[6]||(t[6]=(...e)=>P.onPageDropdownSelect&&P.onPageDropdownSelect(...e)),class:"control-select"},[...t[15]||(t[15]=[(0,n.Fv)('<option disabled selected value="">Select Page Type...</option><option value="info">Info Page</option><option value="lore">Lore Page</option><option value="gameplay">Gameplay Page</option><option value="species">Species Page</option><option value="talent">Talent Page</option><option value="toc">ToC Page</option><option value="advanced">Advanced Page</option>',8)])],32)])]),(0,n.Lk)("div",w,[T.warningText?((0,n.uX)(),(0,n.CE)("div",S,[t[17]||(t[17]=(0,n.Lk)("i",{class:"ra ra-exclamation-triangle"},null,-1)),(0,n.eW)(" "+(0,n.v_)(T.warningText),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",k,[(0,n.bo)((0,n.Lk)("input",{class:"username-input",type:"text",placeholder:"username","onUpdate:modelValue":t[7]||(t[7]=e=>T.username=e)},null,512),[[n.Jo,T.username]])])])]),(0,n.Lk)("div",{ref:"monacoContainer",class:"editor","aria-label":"Markdown editor",tabindex:"0",onClick:t[8]||(t[8]=(...e)=>P.focusEditor&&P.focusEditor(...e))},null,512)]),(0,n.Lk)("div",C,null,512)])}var P=o(9912);const E="linear-gradient(135deg, rgba(185, 194, 202, 1) 0%, rgba(97, 101, 105, 1) 100%);",F=e=>e.endsWith("/")?e:`${e}/`,$=F("/utopia-things-editor/"),M=`${$}assets/tree/points.png`,L=(e,t)=>{switch(e){case 3:return{imageBottom:-2*t-15,bodySoulBottom:21+-2*t,mindBottom:12+-2*t};case 4:return{imageBottom:-2*t-17,bodySoulBottom:19+-2*t,mindBottom:10+-2*t};case 5:return{imageBottom:-2*t-19,bodySoulBottom:17+-2*t,mindBottom:8+-2*t};default:return{imageBottom:0,bodySoulBottom:0,mindBottom:0}}},j=(e,t=0)=>{const o=Number(e);return Number.isNaN(o)?t:o},I=(0,n.pM)({name:"ParentChevron",props:{scale:{type:Number,required:!0},column:{type:Number,required:!0}},setup(e){const t=(0,n.KR)(25),o=(0,n.KR)(!1),i=(0,n.KR)(E),s=(0,n.KR)("#474747"),a=(0,n.KR)("#555555"),r=(0,n.KR)(0),l=(0,n.KR)(100),c=(0,n.KR)(48),d=(0,n.KR)("#FFFFFF"),p=(0,n.EW)(()=>(1150+32*e.scale)/e.scale),u=(0,n.EW)(()=>L(e.scale,0)),m=(0,n.EW)(()=>`myGradient-parent-${e.column}`),h=e=>{t.value=j(e.target.value,t.value)},v=e=>{c.value=j(e.target.value,c.value)},g=e=>{i.value=`url(#${m.value})`,s.value=e.target.value},f=e=>{i.value=`url(#${m.value})`,r.value=j(e.target.value,r.value)},b=e=>{i.value=`url(#${m.value})`,a.value=e.target.value},y=e=>{i.value=`url(#${m.value})`,l.value=j(e.target.value,l.value)},x=e=>{d.value=e.target.value},w=()=>{i.value=E};return{textSize:t,showMenu:o,fill:i,color1:s,color2:a,stop1:r,stop2:l,descriptionTop:c,descriptionColor:d,height:p,offsets:u,gradientId:m,column:e.column,pointsImage:M,updateTextSize:h,updateDescriptionTop:v,updateColorOne:g,updateStopOne:f,updateColorTwo:b,updateStopTwo:y,updateDescriptionColor:x,reset:w}},template:'\n    <div class="chevron-container" @mouseenter="showMenu = true" @mouseleave="showMenu = false">\n      <div class="chevron-svg" :style="{ height: height + \'px\', zIndex: 100 }" style="overflow: visible;">\n        <svg class="chevron" viewBox="0 0 159 170" preserveAspectRatio="none" style="overflow: visible;">\n          <defs>\n            <radialGradient class="radial" :id="gradientId">\n              <stop class="chevron-radial-1" :offset="stop1 + \'%\'" :stop-color="color1" />\n              <stop class="chevron-radial-2" :offset="stop2 + \'%\'" :stop-color="color2" />\n            </radialGradient>\n          </defs>\n          <polyline :fill="fill" points="159 1 159 155 79 170 0 155 0 1 159 1" />\n        </svg>\n      </div>\n      <div class="parent-chevron-controls">\n        <textarea class="title" placeholder="Epic Talent"></textarea>\n        <img :src="pointsImage" alt="points" class="points-img" :style="{ bottom: offsets.imageBottom + \'px\', height: \'104px\' }" />\n        <textarea class="skillbody" placeholder="Some awesome, incredible, homebrew\'d talent" :style="{ fontSize: textSize + \'px\', top: descriptionTop + \'%\' }"></textarea>\n        <input class="body" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.bodySoulBottom + \'px\' }" />\n        <input class="mind" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.mindBottom + \'px\' }" />\n        <input class="soul" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.bodySoulBottom + \'px\' }" />\n      </div>\n\n      <div class="chevron-extras" :style="{ display: showMenu ? \'flex\' : \'none\' }">\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'text-size-parent-\' + column">Font size: {{ textSize }} [1]</label>\n            <input :id="\'text-size-parent-\' + column" :name="\'text-size-parent-\' + column" step="0.01" min="0.3" max="2" placeholder="1" type="number" :value="textSize" @input="updateTextSize" />\n          </div>\n          <div class="control-label">\n            <label :for="\'description-top-parent-\' + column">Height: {{ descriptionTop }}% [50%]</label>\n            <input :id="\'description-top-parent-\' + column" :name="\'description-top-parent-\' + column" step="0.1" min="0" max="100" type="number" :value="descriptionTop" @input="updateDescriptionTop" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'inner-gradient-parent-\' + column">Inner gradient color</label>\n            <input :id="\'inner-gradient-parent-\' + column" :name="\'inner-gradient-parent-\' + column" type="color" :value="color1" @input="updateColorOne" />\n          </div>\n          <div class="control-label">\n            <label :for="\'inner-position-parent-\' + column">and position</label>\n            <input :id="\'inner-position-parent-\' + column" :name="\'inner-position-parent-\' + column" type="number" :value="stop1" placeholder="10" @input="updateStopOne" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'outer-gradient-parent-\' + column">Outer gradient color</label>\n            <input :id="\'outer-gradient-parent-\' + column" :name="\'outer-gradient-parent-\' + column" type="color" :value="color2" @input="updateColorTwo" />\n          </div>\n          <div class="control-label">\n            <label :for="\'outer-position-parent-\' + column">and position</label>\n            <input :id="\'outer-position-parent-\' + column" :name="\'outer-position-parent-\' + column" type="number" :value="stop2" placeholder="95" @input="updateStopTwo" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'description-color-\' + column">Description color</label>\n            <input :id="\'description-color-\' + column" :name="\'description-color-\' + column" type="color" :value="descriptionColor" @input="updateDescriptionColor" />\n          </div>\n        </div>\n        <button type="button" @click="reset">Reset Gradients</button>\n      </div>\n    </div>\n  '}),q=(0,n.pM)({name:"Chevron",props:{position:{type:Number,required:!0},scale:{type:Number,required:!0},column:{type:Number,required:!0}},setup(e){const t=(0,n.KR)(25),o=(0,n.KR)(!1),i=(0,n.KR)(E),s=(0,n.KR)("#474747"),a=(0,n.KR)("#555555"),r=(0,n.KR)(0),l=(0,n.KR)(100),c=(0,n.KR)(46),d=(0,n.KR)("#FFFFFF"),p=-50,u=(0,n.EW)(()=>L(e.scale,e.position)),m=(0,n.EW)(()=>(1150+32*e.scale)/e.scale),h=(0,n.EW)(()=>100-e.position),v=(0,n.EW)(()=>e.position>e.scale?"none":"block"),g=(0,n.EW)(()=>p-20+"px"),f=(0,n.EW)(()=>`myGradient-${e.position}-${e.column}`),b=e=>{t.value=j(e.target.value,t.value)},y=e=>{c.value=j(e.target.value,c.value)},x=e=>{i.value=`url(#${f.value})`,s.value=e.target.value},w=e=>{i.value=`url(#${f.value})`,r.value=j(e.target.value,r.value)},S=e=>{i.value=`url(#${f.value})`,a.value=e.target.value},k=e=>{i.value=`url(#${f.value})`,l.value=j(e.target.value,l.value)},C=e=>{d.value=e.target.value},T=()=>{i.value=E};return{position:e.position,column:e.column,textSize:t,showMenu:o,fill:i,color1:s,color2:a,stop1:r,stop2:l,descriptionTop:c,descriptionColor:d,marginTop:p,offsets:u,height:m,zIndex:h,display:v,extrasTop:g,gradientId:f,pointsImage:M,updateTextSize:b,updateDescriptionTop:y,updateColorOne:x,updateStopOne:w,updateColorTwo:S,updateStopTwo:k,updateDescriptionColor:C,reset:T}},template:'\n    <div class="chevron-container" @mouseenter="showMenu = true" @mouseleave="showMenu = false" :style="{ display }">\n      <div class="chevron-svg" :style="{ marginTop: marginTop + \'px\', height: height + \'px\', zIndex }" style="overflow: visible;">\n        <svg class="chevron" viewBox="0 0 159 170" preserveAspectRatio="none" style="overflow: visible;">\n          <defs>\n            <radialGradient class="radial" :id="gradientId">\n              <stop class="chevron-radial-1" :offset="stop1 + \'%\'" :stop-color="color1" />\n              <stop class="chevron-radial-2" :offset="stop2 + \'%\'" :stop-color="color2" />\n            </radialGradient>\n          </defs>\n          <polyline :fill="fill" points="159 1 159 155 79 170 0 155 0 1 159 1" />\n        </svg>\n      </div>\n      <div class="chevron-controls">\n        <textarea class="title" :style="{ top: \'2%\' }"></textarea>\n        <img :src="pointsImage" alt="points" class="points-img" :style="{ bottom: offsets.imageBottom + \'px\', height: \'104px\' }" />\n        <textarea class="skillbody" :style="{ fontSize: textSize + \'px\', top: descriptionTop + \'%\' }"></textarea>\n        <input class="body" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.bodySoulBottom + \'px\' }" />\n        <input class="mind" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.mindBottom + \'px\' }" />\n        <input class="soul" type="number" maxlength="1" min="0" max="9" value="0" :style="{ bottom: offsets.bodySoulBottom + \'px\' }" />\n      </div>\n\n      <div class="chevron-extras" :style="{ display: showMenu ? \'flex\' : \'none\', top: extrasTop }">\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'text-size-\' + position + \'-\' + column">Font size: {{ textSize }} [1]</label>\n            <input :id="\'text-size-\' + position + \'-\' + column" :name="\'text-size-\' + position + \'-\' + column" step="0.01" min="0.3" max="2" placeholder="1" type="number" :value="textSize" @input="updateTextSize" />\n          </div>\n          <div class="control-label">\n            <label :for="\'description-top-\' + position + \'-\' + column">Height: {{ descriptionTop }}% [50%]</label>\n            <input :id="\'description-top-\' + position + \'-\' + column" :name="\'description-top-\' + position + \'-\' + column" step="0.1" min="0" max="100" type="number" :value="descriptionTop" @input="updateDescriptionTop" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'inner-gradient-\' + position + \'-\' + column">Inner gradient color</label>\n            <input :id="\'inner-gradient-\' + position + \'-\' + column" :name="\'inner-gradient-\' + position + \'-\' + column" type="color" :value="color1" @input="updateColorOne" />\n          </div>\n          <div class="control-label">\n            <label :for="\'inner-position-\' + position + \'-\' + column">and position</label>\n            <input :id="\'inner-position-\' + position + \'-\' + column" :name="\'inner-position-\' + position + \'-\' + column" type="number" :value="stop1" placeholder="10" @input="updateStopOne" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'outer-gradient-\' + position + \'-\' + column">Outer gradient color</label>\n            <input :id="\'outer-gradient-\' + position + \'-\' + column" :name="\'outer-gradient-\' + position + \'-\' + column" type="color" :value="color2" @input="updateColorTwo" />\n          </div>\n          <div class="control-label">\n            <label :for="\'outer-position-\' + position + \'-\' + column">and position</label>\n            <input :id="\'outer-position-\' + position + \'-\' + column" :name="\'outer-position-\' + position + \'-\' + column" type="number" :value="stop2" placeholder="95" @input="updateStopTwo" />\n          </div>\n        </div>\n        <div class="control-group">\n          <div class="control-label">\n            <label :for="\'description-color-\' + column">Description color</label>\n            <input :id="\'description-color-\' + column" :name="\'description-color-\' + column" type="color" :value="descriptionColor" @input="updateDescriptionColor" />\n          </div>\n        </div>\n        <button type="button" @click="reset">Reset Gradients</button>\n      </div>\n    </div>\n  '}),A=(0,n.pM)({name:"TalentTree",components:{ParentChevron:I,Chevron:q},props:{scale:{type:Number,default:5},columns:{type:Number,default:1}},setup(e){const t=(0,n.EW)(()=>Array.from({length:Math.max(1,e.scale-1)},(e,t)=>t+1));return{chevronPositions:t}},template:'\n    <div class="talent-tree-wrapper">\n      <ParentChevron :scale="scale" :column="0" />\n      <div class="talent-tree-children">\n        <Chevron\n          v-for="pos in chevronPositions"\n          :key="pos"\n          :position="pos"\n          :scale="scale"\n          :column="0"\n        />\n      </div>\n    </div>\n  '});class D{constructor(e,t={}){this.container=e,this.options=t,this.mountEl=document.createElement("div"),this.mountEl.className="talent-tree-host",this.container.appendChild(this.mountEl);const{scale:o=5,columns:i=1}=t;this.app=(0,n.Ef)(A,{scale:o,columns:i}),this.app.mount(this.mountEl)}destroy(){this.app&&(this.app.unmount(),this.app=null),this.mountEl&&this.mountEl.parentNode&&this.mountEl.parentNode.removeChild(this.mountEl)}}var _=D;function O(e,t=1){t=Math.max(1,parseInt(t,10)||1);const o=(e||"").split("\n"),n=e=>String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=e=>{let t=n(e);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/\\n/g,"<br/>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,t,o)=>`<a href="${n(o)}">${t}</a>`),t},s=(e,t,o)=>{const n=document.createElement(e);return t&&(n.className=t),void 0!==o&&(n.textContent=o),n},a=()=>s("div","column"),r=e=>{const t=e||"default",o=s("div","page page-"+t);return o.style.setProperty("background",`var(--${t}-background)`),o.appendChild(s("div","page-content")),o},l={comment:/^\/\/\s+(.*)$/i,page:/^\/page\s+(red|pink|orange|yellow|purple|green|blue|talent)\s+(.+)$/i,pageNum:/^\/page-num\s+(\d+)$/i,column:/^\/(column|col)$/i,spacing:/^\/(spacing|sp)\s+(\d+)$/i,equipment:/^\/equipment\s+(crude|common|uncommon|rare|legendary|mythic)\s+(.*)$/i,equipmentDetail:/^\/(type|cost|tag|damage|desc|flavor|craft)\s+(.*)$/i,equipmentNext:/^\/next$/i,spell:/^\/spell\s+(.*)$/i,spellDetail:/^\/(type|arts|tag|sta|stamina|desc)\s+(.*)$/i,spellNext:/^\/next$/i,specialist:/^\/specialist$/i,noteStart:/^\/(note|info|lore)\s+(.*)$/i,blockEnd:/^\/end$/i,toc:/^\/toc\s+(begin|end)$/i,heading:/^(#+)\s+(.*)$/,talentStart:/^\/tree\s+([3-5])$/i,talentContent:/^\/talent\s+(label|description)\s+(.*)$/i,talentEnd:/^\/end-tree$/i,styleBegin:/^\/style\s+begin$/i,styleEnd:/^\/style\s+end$/i,img:/^\/img\s+(\S+)(?:\s+(.*))?$/i,codeFenceBegin:/^```\s*(\w+)?\s*$/,hr:/^-{3,}\s*$/,pageBreak:/^\/page-break$/i,columns:/^\/columns\s+(\d+)$/i},c=s("div","content-parent"),d=[];let p=-1,u=null;const m=[];let h=-1,v=null,g=null,f=null,b=0,y=null,x=[],w=null,S=0,k=null,C=null,T=null,P=null,E=null;const F=[],$=()=>m[p][h],M=()=>{p<0||m[p]&&0!==m[p].length||(m[p]=[a()],u.querySelector(".page-content").appendChild(m[p][0]),h=0)},L=(e,t)=>{const o=r(e);if(d.push(o),c.appendChild(o),p=d.length-1,u=o,m[p]=[],"talent"!==e){const e=a();o.querySelector(".page-content").appendChild(e),m[p].push(e),h=0}else{const e=s("div","full-column talent-content");o.querySelector(".page-content").appendChild(e),m[p].push(e),h=0}if(t){const e=s("div","page-number");/^\d+$/.test(t)?e.textContent=t.toString().padStart(3,"0"):e.textContent=t,u.appendChild(e)}},j=(e,t)=>{const o=s("div","equipment rarity-"+e.toLowerCase()),n=s("div","equipment-content"),i=s("div","equipment-title",t);n.appendChild(i),o.appendChild(n),$().appendChild(o),g=o,f=n,b=0},I=e=>{const t=s("div","spell"),o=s("div","spell-content"),n=s("div","spell-title",e);o.appendChild(n),t.appendChild(o),$().appendChild(t),y=t,w=o,S=0},q=e=>{if(!u)return;const t=Math.max(1,parseInt(e,10)||5),o=u.querySelector(".page-content");o&&(k||(k=s("div","talent-tree"),o.appendChild(k)),C&&(C.destroy(),C=null),k.innerHTML="",C=new _(k,{scale:t,columns:3}))},A=()=>{C&&(C=null,k=null)},D=(e,t)=>{if(!g)return;const o=s("div","equipment-detail "+e.toLowerCase());if("tag"===e.toLowerCase()){const[e,...n]=t.split(":"),i=n.join(":").trim(),a=s("span","equipment-tag-type",e.trim()+": "),r=s("span","equipment-tag-content",i);o.appendChild(a),o.appendChild(r)}else o.textContent=t;f.appendChild(o)},O=(e,t)=>{if(!y)return;const o=s("div","spell-detail "+e.toLowerCase());if("tag"===e.toLowerCase()){const[e,...n]=t.split(":"),i=n.join(":").trim(),a=s("span","equipment-tag-type",e.trim()+": "),r=s("span","equipment-tag-content",i);o.appendChild(a),o.appendChild(r)}else if("arts"===e.toLowerCase()){const e=t.split(",");e.forEach(e=>x.push(e.trim().toLowerCase())),o.textContent=t}else o.textContent=t;w.appendChild(o)},R=()=>{if(!g)return;b+=1;const e=s("div","equipment-section section-"+b);g.appendChild(e),f=e},z=()=>{if(!y)return;S+=1;const e=s("div","spell-section section-"+S);y.appendChild(e),w=e},N=()=>{g=null,f=null,b=0},W=()=>{if(!y)return w=null,S=0,void(x=[]);try{const e=y.querySelector(".section-2"),t=x.length,o=s("div","artistry-container artistry-container-"+t,"");e.appendChild(o);for(const n of x){const e=s("img",`artistry-icon artistry-${n}`,"");e.setAttribute("width","130"),e.setAttribute("height","130"),o.appendChild(e)}y=null,w=null,S=0,x=[]}catch(e){console.error("Error finalizing spell:",e)}},B=(e,t)=>{const o=s("div","note "+e.toLowerCase()),n=(e,t)=>{const o=document.createElement("img");return o.className="box "+e,o.src="../assets/blocks/"+t,o};o.appendChild(n("box-top-left","box-top-left.svg")),o.appendChild(n("box-top-right","box-top-right.svg")),o.appendChild(n("box-bottom-left","box-bottom-left.svg")),o.appendChild(n("box-bottom-right","box-bottom-right.svg"));const a=s("div","box box-gradient "+e.toLowerCase());o.appendChild(a);const r=s("p","note-content");r.innerHTML=i(t),o.appendChild(r),$().appendChild(o),v=o},H=e=>{if(!v)return;const t=s("p","note-content");t.innerHTML=i(e),v.appendChild(t)},V=()=>{v=null},K=()=>{T=s("div","toc"),$().appendChild(T)},U=()=>{T=null},G=(e,t)=>{if(!T)return;const o=s("div","toc-entry"),n=s("span","toc-title");n.textContent=e;const i=s("span","toc-page");i.textContent=t,o.appendChild(n),o.appendChild(i),T.appendChild(o)},Y=(e,t,o,n)=>{e=Math.min(6,e||1);const i=s("h"+e);i.textContent=t,n&&(n.id&&(i.id=n.id),n.classes.forEach(e=>i.classList.add(e)),n.style&&i.setAttribute("style",n.style)),o&&o>1?(i.classList.add("span-"+o),n&&!n.classes.includes("span-"+o)&&i.classList.add("span-"+o),u.appendChild(i),u.classList.add("has-span-"+o)):$().appendChild(i)},X=(e,t)=>{const o=s("p");o.innerHTML=i(e),t&&(t.id&&(o.id=t.id),t.classes.forEach(e=>o.classList.add(e)),t.style&&o.setAttribute("style",t.style)),$().appendChild(o)},Z=e=>{const t=s("div","spacing");t.style.height=e+"px",$().appendChild(t)},J=e=>{const t=s("div","page-number");t.textContent=e.toString().padStart(3,"0"),u.appendChild(t)},Q=()=>{const e=m[p],o=F[p]||t;if(e.length<o){const t=a();e.push(t),u.querySelector(".page-content").appendChild(t),h=e.length-1}else h=(h+1)%o},ee=(e,t)=>{if(u&&$().classList.contains("talent-content")){if("label"===e){const e=s("div","talent-label",t);$().appendChild(e)}if("description"===e){const e=s("div","talent-description","");e.innerHTML=i(t),$().appendChild(e)}}},te=e=>{const t=e.match(/\s\{([^}]*)}\s*$/);if(!t)return{text:e,classes:[],id:null,style:null,span:null};const o=t[1].trim(),n=e.slice(0,t.index).trim(),i=o.match(/(?:"[^"]*"|'[^']*'|[^\s]+)/g)||[],s=[];let a=null,r=null,l=null;return i.forEach(e=>{if(e.startsWith("."))s.push(e.slice(1));else if(e.startsWith("#"))a=e.slice(1);else if(e.toLowerCase().startsWith("style=")){const t=e.substring(6).replace(/^['"]|['"]$/g,"");r=t}else if(/^span-(\d+)$/i.test(e)){const t=e.match(/span-(\d+)/i);l=parseInt(t[1],10)||null}else s.push(e)}),{text:n,classes:s,id:a,style:r,span:l}},oe=()=>{const e=s("div","specialist-table");u.appendChild(e);const t=s("div","specialist-header");e.appendChild(t);const o=s("div","specialist-content");e.appendChild(o);const n=s("div","specialist-row header");["Talent Name","Prerequisites","Abilities"].forEach((e,t)=>{const o=s("div","specialist-cell cell-"+(t+1),e);n.appendChild(o)}),e.appendChild(n),E=e};for(let _=0;_<o.length;_++){const e=o[_];let n,a=e.trim();if(!a)continue;if(!(p<0)||l.page.test(a)||l.styleBegin.test(a)||l.styleEnd.test(a)||l.comment.test(a)||(L("default"),M()),P&&!l.styleEnd.test(a)&&!l.blockEnd.test(a)){P.push(a);continue}if(P&&(l.styleEnd.test(a)||l.blockEnd.test(a))){const e=document.createElement("style"),t=P.join("\n").replace(/[<>]/g,"");e.textContent=t,c.appendChild(e),P=null;continue}if(l.comment.test(a))continue;if(v&&!l.blockEnd.test(a)){H(a);continue}if(g&&!l.blockEnd.test(a)){if(l.equipmentNext.test(a)){R();continue}const e=a.match(l.equipmentDetail);if(e){D(e[1],e[2]);continue}}if(y&&!l.blockEnd.test(a)){if(l.spellNext.test(a)){z();continue}const e=a.match(l.spellDetail);if(e){O(e[1],e[2]);continue}}if(T&&!l.toc.test(a)){const e=a.split("|");if(e.length>=1){const t=e[0].trim(),o=(e[1]||"").trim();G(t,o)}continue}if(E){if(l.blockEnd.test(a)){E=null;continue}{const e=/^\/title\s*(.*)$/i.exec(a);if(e){const t=s("h2","specialist-title",e[1]);E.querySelector(".specialist-header").appendChild(t);continue}const t=/^\/desc\s*(.*)$/i.exec(a);if(t){const e=s("p","specialist-desc");e.innerHTML=i(t[1]),E.querySelector(".specialist-header").appendChild(e);continue}const o=a.split("|").map(e=>e.trim());if(3===o.length){const e=s("div","specialist-row");o.forEach((t,o)=>{const n=s("div","specialist-cell cell-"+(o+1));n.innerHTML=i(t),e.appendChild(n)}),E.querySelector(".specialist-content").appendChild(e);continue}}}if(n=a.match(l.page)){L(n[1].toLowerCase(),n[2]);continue}if(l.styleBegin.test(a)){P=[];continue}if(l.styleEnd.test(a))continue;if(n=a.match(l.pageNum)){J(n[1]);continue}if(n=a.match(l.column)){Q();continue}if(n=a.match(l.columns)){F[p]=parseInt(n[1],10)||t;continue}if(n=a.match(l.spacing)){Z(n[2]);continue}if(n=a.match(l.equipment)){j(n[1],n[2]);continue}if(n=a.match(l.spell)){I(n[1]);continue}if(n=a.match(l.specialist)){oe();continue}if(n=a.match(l.noteStart)){B(n[1],n[2]);continue}if(n=a.match(l.talentStart)){q(n[1]);continue}if(l.talentEnd.test(a)){A();continue}if(n=a.match(l.talentContent)){const e=n[1],t=n[2];ee(e,t);continue}if(n=a.match(l.img)){const e=n[1],t=(n[2]||"").trim(),o=te(t),i=document.createElement("img");i.src=e,i.alt=o.text||"",o.id&&(i.id=o.id),o.classes.forEach(e=>i.classList.add(e)),o.style&&i.setAttribute("style",o.style),$().appendChild(i);continue}if(l.blockEnd.test(a)){V(),N(),W(),U();continue}if(n=a.match(l.toc)){"begin"===n[1].toLowerCase()?K():U();continue}if(l.hr.test(a)||/^\/hr$/i.test(a)){$().appendChild(document.createElement("hr"));continue}if(l.pageBreak.test(a)){const e=s("div","page-break");$().appendChild(e);continue}if(n=a.match(l.heading)){const e=n[1].length;let t=n[2].trim();const o=te(t);t=o.text,Y(e,t,o.span,o);continue}const r=a.match(/^[-*]\s+(.*)$/);if(r){const e=s("ul");while(_<o.length){const t=o[_].trim(),n=t.match(/^[-*]\s+(.*)$/);if(!n)break;const a=s("li");a.innerHTML=i(n[1]),e.appendChild(a),_++}_--,M(),$().appendChild(e);continue}const d=a.match(/^(\d+)\.\s+(.*)$/);if(d){const e=s("ol");while(_<o.length){const t=o[_].trim(),n=t.match(/^(\d+)\.\s+(.*)$/);if(!n)break;const a=s("li");a.innerHTML=i(n[2]),e.appendChild(a),_++}_--,M(),$().appendChild(e);continue}let u;if(u=a.match(l.codeFenceBegin)){const e=u[1]||"",t=[];_++;while(_<o.length&&!/^```\s*$/.test(o[_]))t.push(o[_]),_++;const n=s("pre"),i=s("code");e&&(i.className="language-"+e),i.textContent=t.join("\n"),n.appendChild(i),M(),$().appendChild(n);continue}M();const m=te(a);X(m.text,m)}return c}var R=o(7390),z=o.n(R),N=o(1710),W=o.n(N),B=o(4213),H=o(960),V={name:"ThingsEditor",data(){return{documentType:"info",columnCount:2,docWidth:1275,docHeight:1650,headerFontPx:58.333333333333336,subheaderFontPx:50,bodyFontPx:25,dpi:150,headerFontPt:28,subheaderFontPt:24,bodyFontPt:12,isSaving:!1,warningText:"",username:""}},mounted(){setInterval(()=>{const e=this._monacoEditor?this._monacoEditor.getModel():null;e&&e.getValue().length>0&&(this.isSaving=!0,this.saveState(),setTimeout(()=>this.isSaving=!1,1e3))},2e4),this.$nextTick(()=>{this.tick();const e=this.$refs.viewerContainer;e&&("info"===this.documentType?e.style.setProperty("--header-color","#0067a9"):e.style.setProperty("--header-color","#8349a4")),this.$watch("documentType",()=>{const e=this.$refs.viewerContainer&&this.$refs.viewerContainer.querySelector(".viewer-content");switch(this.documentType){case"info":e&&(e.style.backgroundImage="url('../assets/documents/info-sheet.png')",e.style.backgroundSize="100% 100%",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="top left"),this.$refs.viewerContainer&&this.$refs.viewerContainer.style.setProperty("--header-color","#0067a9");break;case"lore":e&&(e.style.backgroundImage="url('../assets/documents/lore-sheet.png')",e.style.backgroundSize="100% 100%",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="top left"),this.$refs.viewerContainer&&this.$refs.viewerContainer.style.setProperty("--header-color","#8349a4");break}}),this.$watch("username",()=>{const e=this.$refs.viewerContainer;if(e)for(const t of e.querySelectorAll(".page")){const e=t.querySelector(".username-display");e&&(e.textContent=document.querySelector(".username-input")?document.querySelector(".username-input").value.trim():"")}})})},beforeUnmount(){try{this._monacoEditor&&(this._monacoEditor.dispose(),this._monacoEditor=null)}catch(e){}try{this._viewerResizeObserver&&(this._viewerResizeObserver.disconnect(),this._viewerResizeObserver=null)}catch(e){}try{this._editorResizeObserver&&(this._editorResizeObserver.disconnect(),this._editorResizeObserver=null)}catch(e){}try{window&&window.__thingsEditor&&delete window.__thingsEditor}catch(e){}},methods:{updateUsernameDisplays(){const e=this.$refs.viewerContainer;if(e)for(const t of e.querySelectorAll(".page")){const e=t.querySelector(".username-display");e&&(e.textContent="Authored by: "+(document.querySelector(".username-input")?document.querySelector(".username-input").value.trim():""))}},onItemDropdownSelect(e){console.log("Item dropdown changed:",e),"sample_javelin"===e.target.value?this.onInsertSelect({value:["/equipment mythic JAVELIN OF THE SKIES","/type Fast Weapon, Mythical","/cost 7040 Silver Pieces","/next","/tag Attack Speed: 1 Turn Action","/tag Handling: 2 hands","/tag Range: 15 meters (Ranged)","/tag Size: 27 slots","/next","/damage 7d4 Energy Damage","/desc Attacks made with this weapon affect all creatures within a 1 meter wide line, originating from the user, extending out to the weapon's range. Tests for accuracy do not need to be made.","/desc This weapon is sentient, sensing objects and creatures within 10 meters of it, and can communicate basic emotions directly to its user.","/desc Damage dealt by this weapon ignores defenses.","/desc This weapon requires 1 stamina to attack with. This weapon consumes 1 cell during each attack. Ammunition used this way must be equipped on the user's back or waist slot.","/next","/flavor One of three weapons a part of the Nine Divines. It uses its sentience to implore progress and calculated improvement. Naturally, it hovers between the two hands of its user, firing trailing shards of lightning at high speeds.","/craft 1 Mythical Material Component","/craft 4 Mythical Refinement Components","/craft 3 Mythical Power Components","/end"].join("\n")}):"equipment"===e.target.value?this.onInsertSelect({value:["/equipment <rarity> <name>","/type","/cost","/next","/tag <tag>","/next","/damage 7d4 <damageType> Damage","/desc <description>","/next","/flavor <flavor text>","/craft <quantity> <component>","/end"].join("\n")}):"sample_specialist_table"===e.target.value?this.onInsertSelect({value:["/page talent 1","/specialist","/title Arcane Specialist Talents","/desc Arcane specialist talents are used to push a caster when putting spells together, allowing for significant versatility. Some require that the caster have a specific talent within the Magecraft tree, others require that the caster can simply cast spells at all, even less require specific trait scores.","Subtle Spells | Must have at least one talent from the **Magecraft** core talent tree. | You may cast spells without making any physical or audible gestures. Creatures gaina point of favor on tests made to resist spells cast this way. You may cast spells 2 meters through a medium rather than 1.","Mystical Cognizance | Must have the **Subtle Spells** specialist talent. | When casting spells with no physical gestures, creatures do not gain a point of favor on tests made to resist spells cast this way. You may cast spells 3 meters through a medium rather than 2.","Arcane Withdrawal | Must know the Art of **Enchantment.** | You may spend 6 turn actions to undo a permanent spell that you cast, given you are within 1 meter of the spell's effects.","In Tune | Must have a **Will** score of 10 or higher. | Your spellcap is equal to your **Will** score. If you have no Spellcap, spells you cast cost less stamina by an amount equal to your **Soul** score.","Enlightened | Must have the **In Tune** specialist talent.\\nMust be able to use at least three **Arcane Arts.** | Your Spellcap is equal to double your **Will** score. If you have no Spellcap, spells you cast cost less stamina by an amount equal to your **Mind** score.","Occult Mind | Must have at least one talent rom the **Magecraft** core talent tree. | You gain 2 points of favor on tests made to resist losing Focus or breaking Concentration.","Pyromancy | Must know the Art of **Evocation.** | You may cast spells that deal only Heat damage and cost 3 stamina or less after discounts without spending any stamina.","Cryomancy | Must know the Art of **Evocation.** | You may cast spells that deal only Chill damage and cost 3 stamina or less after discounts without spending any stamina.","/end"].join("\n")}):"sample_spell"===e.target.value&&this.onInsertSelect({value:["/page equipment 1","/spell DISPEL","/type Utility","/arts Enchantment, Illusion, Necromancy, Evocation","/next","/tag Duration: Immediate","/tag Range: Touch","/tag AOE: Target Spell","/next","/stamina 5 TIMES X STAMINA","/desc You grasp something affected by a spell, methodically unweaving its runes. If a creature is currently focusing or concentrating on the spell, it makes a Will contest against you. Given the spell is no older than X hours and any apposing creatures fail their test, the spell ends.","/end"].join("\n")}),this.selectedItemType=""},onPageDropdownSelect(e){const t=e.target.value;t&&(this.onInsertSelect({value:`/page ${t} 1`}),this.selectedPageType="")},onEquipmentButtonClick(){this.onItemDropdownSelect()},onPageButtonClick(e){this.selectedPageType=e,this.onPageDropdownSelect()},loadState(){const e=localStorage.getItem("things-editor-content");if(console.log("Loaded content:",e),"string"===typeof e&&this._monacoEditor){const o=this._monacoEditor,n=o.getModel();if(n){const i=n.getValue();if(e!==i){let i=null,s=!1;try{i=o.getSelection(),s=document.activeElement&&this.$refs.monacoContainer&&this.$refs.monacoContainer.contains(document.activeElement)}catch(t){}n.setValue(e);try{i&&o.setSelection(i),s&&o.focus()}catch(t){}}}}},saveState(){const e=Date.now();if(this._lastSave&&e-this._lastSave<200)return;if(this._lastSave=e,!this._monacoEditor)return;const t=this._monacoEditor.getModel();if(!t)return;const o=t.getValue();try{localStorage.setItem("things-editor-content",o)}catch(n){console.warn("Failed to save to localStorage:",n)}console.log("Saved content:",o)},tick(){const e=this.$refs.monacoContainer,t=this.$refs.viewerContainer;if(e&&t){try{P.eo.register({id:"utopia"}),P.eo.setMonarchTokensProvider("utopia",{defaultToken:"invalid",keywords:[],typeKeywords:[],operators:[],symbols:/[-+*/=<>!]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/^\/(page|column|note|info|lore|end|spacing|page-num|advanced|toc)\b/i,"utopia.command"],[/(equipment|gameplay|info|lore|species|talent|toc|advanced)\b/i,"utopia.pagetype"],[/\/(specialist)\b/i,"utopia.talent"],[/\/(equipment|spell)\b/i,"utopia.equipment"],[/\/(type|cost|tag|damage|desc|flavor|craft)\b/i,"utopia.equipment"],[/\bcrude\b/i,"utopia.crude"],[/\bcommon\b/i,"utopia.common"],[/\buncommon\b/i,"utopia.uncommon"],[/\brare\b/i,"utopia.rare"],[/\blegendary\b/i,"utopia.legendary"],[/\bmythic(?:al)?\b/i,"utopia.mythical"],[/^\/\/\s+(.*)$/i,"utopia.comment"],[/\b\d+\b/,"number"],[/^#{1,6}[^\n]*/,"utopia.heading"],[/\*\*(.+?)\*\*/,"utopia.strong"],[/\*(.+?)\*/,"utopia.emphasis"],[/@escapes/,"string.escape"],[/\n/,"string.escape"],[/[A-Za-z0-9\s]+(?=\||$)/,"table-cell"],[/[ \t]+/,""],[/\|/,"delimiter.pipe"],[/[^|\n]+/,""]]}}),P.EN.defineTheme("utopia-theme",{base:"vs-dark",inherit:!0,rules:[{token:"utopia.command",foreground:"FFA500",fontStyle:"bold"},{token:"utopia.pagetype",foreground:"00e5ff"},{token:"utopia.equipment",foreground:"ff79c6"},{token:"utopia.comment",foreground:"6272a4"},{token:"utopia.talent",foreground:"ffb86c"},{token:"utopia.crude",foreground:"8f9092"},{token:"utopia.common",foreground:"737790"},{token:"utopia.uncommon",foreground:"809a7d"},{token:"utopia.rare",foreground:"c0b985"},{token:"utopia.legendary",foreground:"b78e70"},{token:"utopia.mythical",foreground:"a7645b"},{token:"table-cell",foreground:"ff965d"},{token:"utopia.heading",foreground:"ffd166",fontStyle:"bold"},{token:"number",foreground:"c792ea"},{token:"utopia.strong",fontStyle:"bold"},{token:"utopia.emphasis",fontStyle:"italic"},{token:"string.escape",foreground:"ff79c6"},{token:"delimiter.pipe",foreground:"ffd166"}],colors:{"editor.background":"#1e1e1e"}})}catch(o){console.warn("Monaco language/theme registration issue:",o)}const n=P.EN.create(e,{language:"utopia",wordWrap:"on",theme:"utopia-theme"});try{n.focus()}catch(o){}this._monacoEditor=n;try{window.__thingsEditor=n}catch(o){}const i=()=>{const e=n.getValue();this.warningText="",t.innerHTML="";const o=document.createElement("div");o.className="viewer-content",o.style.width=this.docWidth+"px",o.style.height=this.docHeight+"px",o.style.setProperty("--header-font-px",this.headerFontPx+"px"),o.style.setProperty("--subheader-font-px",this.subheaderFontPx+"px"),o.style.setProperty("--body-font-px",this.bodyFontPx+"px"),o.style.setProperty("--doc-height",this.docHeight+"px"),o.style.setProperty("--doc-width",this.docWidth+"px"),"info"===this.documentType?o.style.setProperty("--header-color","#0067a9"):o.style.setProperty("--header-color","#8349a4"),o.style.backgroundSize="100% 100%",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="top left";const i=O(e,this.columnCount);o.appendChild(i),t.appendChild(o);for(const t of o.querySelectorAll(".page")){const e=document.createElement("div");e.className="username-display",e.textContent="Authored by: "+(document.querySelector(".username-input")?document.querySelector(".username-input").value.trim():""),t.appendChild(e)}this.updateScale()};if(i(),n.onDidChangeModelContent(()=>{i()}),this.$watch("docWidth",()=>{i()}),this.$watch("docHeight",()=>i()),this.$watch("headerFontPx",()=>{this.headerFontPt=this.pxToPt(this.headerFontPx,this.dpi),this.updateVars()}),this.$watch("bodyFontPx",()=>{this.bodyFontPt=this.pxToPt(this.bodyFontPx,this.dpi),this.updateVars()}),this.$watch("columnCount",()=>i()),this.$watch("dpi",()=>{this.headerFontPx=this.ptToPx(this.headerFontPt,this.dpi),this.subheaderFontPx=this.ptToPx(this.subheaderFontPt,this.dpi),this.bodyFontPx=this.ptToPx(this.bodyFontPt,this.dpi),i()}),this.$watch("headerFontPt",()=>{this.headerFontPx=this.ptToPx(this.headerFontPt,this.dpi),this.updateVars()}),this.$watch("subheaderFontPt",()=>{this.subheaderFontPx=this.ptToPx(this.subheaderFontPt,this.dpi),this.updateVars()}),this.$watch("bodyFontPt",()=>{this.bodyFontPx=this.ptToPx(this.bodyFontPt,this.dpi),this.updateVars()}),window.ResizeObserver){const e=new ResizeObserver(()=>this.updateScale());e.observe(t),this._viewerResizeObserver=e}else window.addEventListener("resize",this.updateScale.bind(this));if(e){const t=window.ResizeObserver?new ResizeObserver(()=>{try{n.layout()}catch(o){}}):null;t?(t.observe(e),this._editorResizeObserver=t):window.addEventListener("resize",()=>{try{n.layout()}catch(o){}})}}},focusEditor(){if(this._monacoEditor)try{this._monacoEditor.focus()}catch(e){}else if(this.$refs&&this.$refs.monacoContainer)try{this.$refs.monacoContainer.focus()}catch(e){}},onInsertSelect(e){if(!this._monacoEditor)return;const t=e&&e.value?e.value:"",o=this._monacoEditor.getModel(),n=this._monacoEditor.getPosition();if(!o||!n){const e=o.getValue();return void o.setValue(e+"\n"+t+"\n")}this._monacoEditor.executeEdits("insert-dropdown",[{range:new P.Q6(n.lineNumber,n.column,n.lineNumber,n.column),text:t+"\n",forceMoveMarkers:!0}]),this._monacoEditor.focus()},exportImage:async function(){const e=this.$refs.viewerContainer;if(e)try{await z().toPng(e);const i=Array.from(document.querySelectorAll(".page"));if(0===i.length)return console.warn("No pages found to export."),void alert("No pages found to export.");const s=new(W()),a=[];for(let e=0;e<i.length;e++){const n=i[e];var t=n.querySelector(".page-number")?n.querySelector(".page-number").textContent.trim():`page-${e+1}`;a.includes(t)&&(console.warn(`Duplicate page number found: ${t}`),alert(`Duplicate page number found: ${t}`),t=`${t} - ${e}`),a.push(t);try{let o=null;if(z()&&"function"===typeof z().toBlob)o=await z().toBlob(n);else{const e=await z().toPng(n);o=function(e){const t=e.split(","),o=t[0].match(/:(.*?);/)[1],n=atob(t[1]);let i=n.length;const s=new Uint8Array(i);while(i--)s[i]=n.charCodeAt(i);return new Blob([s],{type:o})}(e)}o?(s.file(`${t}.png`,o),console.log(`Added ${t}.png (${o.size} bytes) to ZIP`)):console.warn(`No blob produced for page ${e+1}`)}catch(o){console.error(`Error exporting page ${e+1}:`,o)}}const r=await s.generateAsync({type:"blob"});try{B.saveAs(r,"document.zip"),console.log("ZIP generated and download triggered via FileSaver")}catch(o){console.warn("FileSaver failed, falling back to anchor method:",o);try{const e=URL.createObjectURL(r),t=document.createElement("a");t.href=e,t.download="document.zip",document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(e),1e4),console.log("ZIP generated and download triggered via anchor fallback")}catch(n){console.error("Anchor fallback failed to save the zip:",n),alert("Failed to trigger download. Check console for details.")}}}catch(i){console.error("Error creating ZIP:",i)}},exportPdf:async function(){const e=this.$refs.viewerContainer;if(!e)return;const t=Array.from(e.querySelectorAll(".page"));if(0===t.length)return console.warn("No pages found to export."),void alert("No pages found to export.");try{const e=await H.PDFDocument.create(),s={regular:await e.embedFont(H.StandardFonts.Helvetica),bold:await e.embedFont(H.StandardFonts.HelveticaBold),italic:await e.embedFont(H.StandardFonts.HelveticaOblique),boldItalic:await e.embedFont(H.StandardFonts.HelveticaBoldOblique)},a=this.pxToPt(this.docWidth,this.dpi),r=this.pxToPt(this.docHeight,this.dpi);for(let n=0;n<t.length;n++){const i=t[n],l=e.addPage([a,r]);try{const t=await z().toPng(i),o=await e.embedPng(t);l.drawImage(o,{x:0,y:0,width:a,height:r,opacity:.35})}catch(o){console.warn(`Unable to capture background for page ${n+1}:`,o)}const c=i.getBoundingClientRect(),d=c.width>0?c.width/this.docWidth:1,p=this._collectTextBlocks(i);for(const e of p){const t=window.getComputedStyle(e);if("none"===t.display||"hidden"===t.visibility)continue;const o=this._normalizeTextContent(e.innerText);if(!o)continue;const n=e.getBoundingClientRect(),i=parseFloat(t.paddingLeft)||0,a=parseFloat(t.paddingRight)||0,p=parseFloat(t.paddingTop)||0,u=Math.max(0,n.width/d-i-a);if(u<=0)continue;const m=(n.left-c.left)/d+i,h=(n.top-c.top)/d+p,v=parseFloat(t.fontSize)||this.bodyFontPx,g="normal"===t.lineHeight?1.2*v:parseFloat(t.lineHeight)||1.2*v,f=this.pxToPt(v,this.dpi),b=this.pxToPt(g,this.dpi),y=this.pxToPt(u,this.dpi),x=this._resolveFont(t,s),{color:w,opacity:S}=this._cssColorToRgb(t.color,parseFloat(t.opacity)),k=this._wrapTextIntoLines(x,o,f,y);if(!k.length)continue;let C=r-this.pxToPt(h,this.dpi)-f;const T=t.textAlign||"left";for(const e of k){const t=x.widthOfTextAtSize(e,f);let o=this.pxToPt(m,this.dpi);if("center"===T?o+=Math.max(0,(y-t)/2):"right"===T&&(o+=Math.max(0,y-t)),l.drawText(e,{x:o,y:C,size:f,font:x,color:w,opacity:S}),C-=b,C<-r)break}}}const l=await e.save(),c=new Blob([l],{type:"application/pdf"});try{B.saveAs(c,"document.pdf")}catch(n){console.warn("FileSaver failed, falling back to anchor method:",n);try{const e=URL.createObjectURL(c),t=document.createElement("a");t.href=e,t.download="document.pdf",document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(e),1e4)}catch(i){console.error("Failed to trigger PDF download:",i),alert("Failed to export PDF. Check console for details.")}}}catch(s){console.error("Error creating PDF:",s),alert("Failed to export PDF. Check console for details.")}},_collectTextBlocks(e){const t=[],o=e=>{if(!(e instanceof HTMLElement))return;const n=e.tagName?e.tagName.toLowerCase():"";if("script"===n||"style"===n)return;if(e.classList.contains("page-watermark"))return;const i=window.getComputedStyle(e);if("none"===i.display||"hidden"===i.visibility||0===parseFloat(i.opacity))return;const s=Array.from(e.children).filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&0!==parseFloat(t.opacity)}),a=s.some(e=>{const t=window.getComputedStyle(e).display;return"inline"!==t&&"contents"!==t}),r=Array.from(e.childNodes).some(e=>e.nodeType===Node.TEXT_NODE&&e.textContent&&e.textContent.trim().length>0),l=i.display,c="inline"!==l&&"contents"!==l;r&&c&&!a&&t.push(e);for(const t of s)o(t)};return o(e),t},_cssColorToRgb(e,t=1){const o=Number.isFinite(t)?t:1;if(!e||"string"!==typeof e)return{color:(0,H.rgb)(0,0,0),opacity:Math.max(0,Math.min(1,o))};const n=e.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\)/i);if(n){const e=Math.min(255,parseInt(n[1],10)||0)/255,t=Math.min(255,parseInt(n[2],10)||0)/255,i=Math.min(255,parseInt(n[3],10)||0)/255,s=void 0!==n[4]?parseFloat(n[4]):1,a=Number.isFinite(s)?s*o:o;return{color:(0,H.rgb)(e,t,i),opacity:Math.max(0,Math.min(1,a))}}const i=e.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(i){let e=i[1];3===e.length&&(e=e.split("").map(e=>e+e).join(""));const t=parseInt(e,16),n=(t>>16&255)/255,s=(t>>8&255)/255,a=(255&t)/255;return{color:(0,H.rgb)(n,s,a),opacity:Math.max(0,Math.min(1,o))}}return{color:(0,H.rgb)(0,0,0),opacity:Math.max(0,Math.min(1,o))}},_resolveFont(e,t){const o=e.fontWeight,n="bold"===o||"bolder"===o||(parseInt(o,10)||0)>=600,i=e.fontStyle,s="italic"===i||"oblique"===i;return n&&s?t.boldItalic:n?t.bold:s?t.italic:t.regular},_normalizeTextContent(e){return e&&"string"===typeof e?e.replace(/\u00A0/g," ").replace(/[\t\r]+/g," ").replace(/\s+\n/g,"\n").replace(/\n\s+/g,"\n").replace(/ +/g," ").trim():""},_wrapTextIntoLines(e,t,o,n){if(!t||"string"!==typeof t)return[];if(!e||!Number.isFinite(o)||o<=0)return t.split("\n");if(!Number.isFinite(n)||n<=0)return t.split("\n");const i=[],s=t.split("\n");for(const a of s){const t=a.trim();if(!t){i.push("");continue}const s=t.split(" ");let r="";for(const a of s){const t=a.trim();if(!t)continue;const s=r?`${r} ${t}`:t,l=e.widthOfTextAtSize(s,o);if(l<=n){r=s;continue}r&&(i.push(r),r="");const c=e.widthOfTextAtSize(t,o);if(c<=n){r=t;continue}const d=this._breakWordIntoChunks(e,t,o,n);if(d.length){for(let e=0;e<d.length-1;e++)i.push(d[e]);r=d[d.length-1]}else r=t}r?i.push(r):0===t.length&&i.push("")}return i},_breakWordIntoChunks(e,t,o,n){if(!t)return[];const i=[];let s="";for(const a of Array.from(t)){const t=s+a,r=e.widthOfTextAtSize(t,o);r<=n||0===s.length?s=t:(i.push(s),s=a)}return s&&i.push(s),i},updateScale(){this.$nextTick(()=>{const e=this.$refs.viewerContainer;if(!e)return;const t=e.querySelector(".viewer-content");if(!t)return;const o=e.clientWidth,n=e.clientHeight,i=parseFloat(this.docWidth||1),s=parseFloat(this.docHeight||1),a=o/i,r=n/s,l=Math.min(a,r,1),c=i*l,d=s*l,p=o>c?(o-c)/2:0,u=n>d?(n-d)/2:0;t.style.transformOrigin="top left",t.style.transform=`translate(${p}px, ${u}px) scale(${l})`,t.style.setProperty("--scale",l)})},updateVars(){this.$nextTick(()=>{const e=this.$refs.viewerContainer;if(!e)return;const t=e.querySelector(".viewer-content");t&&(t.style.setProperty("--header-font-px",this.headerFontPx+"px"),t.style.setProperty("--subheader-font-px",this.subheaderFontPx+"px"),t.style.setProperty("--body-font-px",this.bodyFontPx+"px"))})},ptToPx(e,t){return(parseFloat(e)||0)*(parseFloat(t)||72)/72},pxToPt(e,t){return 72*(parseFloat(e)||0)/(parseFloat(t)||72)}}},K=o(6262);const U=(0,K.A)(V,[["render",T]]);var G=U,Y={name:"App",components:{ThingsEditor:G}};const X=(0,K.A)(Y,[["render",i]]);var Z=X;(0,n.Ef)(Z).mount("#app")},5890:function(e,t,o){var n={"./simpleWorker":5585,"./simpleWorker.js":5585,"monaco-editor/esm/vs/base/common/worker/simpleWorker":5585,"monaco-editor/esm/vs/base/common/worker/simpleWorker.js":5585};function i(e){return Promise.resolve().then(function(){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}var i=n[e];return o(i)})}i.keys=function(){return Object.keys(n)},i.id=5890,e.exports=i},9204:function(e,t,o){var n={"./editorBaseApi":[3059],"./editorBaseApi.js":[3059],"./editorSimpleWorker":[4003],"./editorSimpleWorker.js":[4003],"./editorWorker":[304],"./editorWorker.js":[304],"./editorWorkerHost":[6358],"./editorWorkerHost.js":[6358],"./findSectionHeaders":[9307],"./findSectionHeaders.js":[9307],"./getIconClasses":[5767],"./getIconClasses.js":[5767],"./languageFeatureDebounce":[2060],"./languageFeatureDebounce.js":[2060],"./languageFeatures":[2230],"./languageFeatures.js":[2230],"./languageFeaturesService":[6127],"./languageFeaturesService.js":[6127],"./languageService":[3930],"./languageService.js":[3930],"./languagesAssociations":[5996],"./languagesAssociations.js":[5996],"./languagesRegistry":[6995],"./languagesRegistry.js":[6995],"./markerDecorations":[886],"./markerDecorations.js":[886],"./markerDecorationsService":[11],"./markerDecorationsService.js":[11],"./model":[4830],"./model.js":[4830],"./modelService":[931],"./modelService.js":[931],"./resolverService":[7042],"./resolverService.js":[7042],"./semanticTokensDto":[9376],"./semanticTokensDto.js":[9376],"./semanticTokensProviderStyling":[7642],"./semanticTokensProviderStyling.js":[7642],"./semanticTokensStyling":[2891],"./semanticTokensStyling.js":[2891],"./semanticTokensStylingService":[8148],"./semanticTokensStylingService.js":[8148],"./textModelSync/textModelSync.impl":[1171],"./textModelSync/textModelSync.impl.js":[1171],"./textModelSync/textModelSync.protocol":[5628,5628],"./textModelSync/textModelSync.protocol.js":[5628,5628],"./textResourceConfiguration":[1504],"./textResourceConfiguration.js":[1504],"./treeSitterParserService":[5320],"./treeSitterParserService.js":[5320],"./treeViewsDnd":[2603],"./treeViewsDnd.js":[2603],"./treeViewsDndService":[6756],"./treeViewsDndService.js":[6756],"./unicodeTextModelHighlighter":[9887],"./unicodeTextModelHighlighter.js":[9887],"monaco-editor/esm/vs/editor/common/services/editorBaseApi":[3059],"monaco-editor/esm/vs/editor/common/services/editorBaseApi.js":[3059],"monaco-editor/esm/vs/editor/common/services/editorSimpleWorker":[4003],"monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js":[4003],"monaco-editor/esm/vs/editor/common/services/editorWorker":[304],"monaco-editor/esm/vs/editor/common/services/editorWorker.js":[304],"monaco-editor/esm/vs/editor/common/services/editorWorkerHost":[6358],"monaco-editor/esm/vs/editor/common/services/editorWorkerHost.js":[6358],"monaco-editor/esm/vs/editor/common/services/findSectionHeaders":[9307],"monaco-editor/esm/vs/editor/common/services/findSectionHeaders.js":[9307],"monaco-editor/esm/vs/editor/common/services/getIconClasses":[5767],"monaco-editor/esm/vs/editor/common/services/getIconClasses.js":[5767],"monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce":[2060],"monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js":[2060],"monaco-editor/esm/vs/editor/common/services/languageFeatures":[2230],"monaco-editor/esm/vs/editor/common/services/languageFeatures.js":[2230],"monaco-editor/esm/vs/editor/common/services/languageFeaturesService":[6127],"monaco-editor/esm/vs/editor/common/services/languageFeaturesService.js":[6127],"monaco-editor/esm/vs/editor/common/services/languageService":[3930],"monaco-editor/esm/vs/editor/common/services/languageService.js":[3930],"monaco-editor/esm/vs/editor/common/services/languagesAssociations":[5996],"monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":[5996],"monaco-editor/esm/vs/editor/common/services/languagesRegistry":[6995],"monaco-editor/esm/vs/editor/common/services/languagesRegistry.js":[6995],"monaco-editor/esm/vs/editor/common/services/markerDecorations":[886],"monaco-editor/esm/vs/editor/common/services/markerDecorations.js":[886],"monaco-editor/esm/vs/editor/common/services/markerDecorationsService":[11],"monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js":[11],"monaco-editor/esm/vs/editor/common/services/model":[4830],"monaco-editor/esm/vs/editor/common/services/model.js":[4830],"monaco-editor/esm/vs/editor/common/services/modelService":[931],"monaco-editor/esm/vs/editor/common/services/modelService.js":[931],"monaco-editor/esm/vs/editor/common/services/resolverService":[7042],"monaco-editor/esm/vs/editor/common/services/resolverService.js":[7042],"monaco-editor/esm/vs/editor/common/services/semanticTokensDto":[9376],"monaco-editor/esm/vs/editor/common/services/semanticTokensDto.js":[9376],"monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling":[7642],"monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling.js":[7642],"monaco-editor/esm/vs/editor/common/services/semanticTokensStyling":[2891],"monaco-editor/esm/vs/editor/common/services/semanticTokensStyling.js":[2891],"monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService":[8148],"monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService.js":[8148],"monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl":[1171],"monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl.js":[1171],"monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol":[5628,5628],"monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol.js":[5628,5628],"monaco-editor/esm/vs/editor/common/services/textResourceConfiguration":[1504],"monaco-editor/esm/vs/editor/common/services/textResourceConfiguration.js":[1504],"monaco-editor/esm/vs/editor/common/services/treeSitterParserService":[5320],"monaco-editor/esm/vs/editor/common/services/treeSitterParserService.js":[5320],"monaco-editor/esm/vs/editor/common/services/treeViewsDnd":[2603],"monaco-editor/esm/vs/editor/common/services/treeViewsDnd.js":[2603],"monaco-editor/esm/vs/editor/common/services/treeViewsDndService":[6756],"monaco-editor/esm/vs/editor/common/services/treeViewsDndService.js":[6756],"monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter":[9887],"monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter.js":[9887]};function i(e){if(!o.o(n,e))return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=n[e],i=t[0];return Promise.all(t.slice(1).map(o.e)).then(function(){return o(i)})}i.keys=function(){return Object.keys(n)},i.id=9204,e.exports=i}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,o),s.exports}o.m=e,function(){o.amdO={}}(),function(){var e=[];o.O=function(t,n,i,s){if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],i=e[d][1],s=e[d][2];for(var r=!0,l=0;l<n.length;l++)(!1&s||a>=s)&&Object.keys(o.O).every(function(e){return o.O[e](n[l])})?n.splice(l--,1):(r=!1,s<a&&(a=s));if(r){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,i,s]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce(function(t,n){return o.f[n](e,t),t},[]))}}(),function(){o.u=function(e){return"js/"+e+"."+{198:"019281a0",205:"be988e82",398:"69575a9b",494:"b89d81c7",558:"3d98b531",910:"07627dc0",946:"8bd6966d",968:"93dcd98b",970:"5966d6de",1118:"15282e03",1122:"cfb3ef65",1282:"fe485f76",1420:"b6d319fd",1438:"cd56bc64",1446:"723579ce",1560:"e1c2012f",1710:"365111e7",1740:"60cd1a85",1888:"347a0ce3",1914:"f5ef0dc3",2077:"91fa0ff8",2094:"ca683993",2244:"b0b04def",2278:"31aec673",2398:"6d75374a",2586:"d68a1ef4",2658:"b7a6e5e0",2686:"7c641f9a",2692:"3063380d",2745:"1588fb81",2962:"15c4ae8f",3042:"6c75c68a",3062:"8610b604",3096:"c1b9df44",3182:"3c94dc32",3622:"9bef8934",3726:"cf3bdbf6",4114:"53ba94e6",4120:"64ebe536",4334:"c35675f2",4630:"c752b031",4680:"3ac34c98",4698:"8057b0c7",4839:"a1498f0d",4958:"8730b31c",4962:"34107969",5130:"b32ce11f",5196:"986b08da",5364:"83c7c473",5550:"e043983b",5618:"579221bd",5628:"652b5ba0",5786:"9d2fb584",5966:"93daa54c",6018:"4bfaea07",6134:"31ac4595",6185:"50d53859",6302:"eefcb942",6414:"5215c642",6446:"e2507bc6",6590:"39cf1ba2",6830:"d1e27f9f",6940:"e244bf19",6990:"e8352b4c",7048:"aeff6a27",7200:"d6e8fb13",7246:"a7457529",7466:"f5692250",7614:"bbe567f9",7836:"30f7ef17",7886:"4f4416aa",8230:"e36f02c9",8332:"2977d15b",8334:"7cfa7470",8390:"20350234",8494:"7efc76d6",8542:"c4468ea6",8566:"10bf1b35",8902:"7c55c148",8990:"577df295",9034:"116f7535",9038:"e307fc2b",9150:"0fa22a99",9355:"86db726d",9390:"fa40267e",9510:"fe86be6b",9838:"c93b6fa0"}[e]+".js"}}(),function(){o.miniCssF=function(e){}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="things-editor:";o.l=function(n,i,s,a){if(e[n])e[n].push(i);else{var r,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var p=c[d];if(p.getAttribute("src")==n||p.getAttribute("data-webpack")==t+s){r=p;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,o.nc&&r.setAttribute("nonce",o.nc),r.setAttribute("data-webpack",t+s),r.src=n),e[n]=[i];var u=function(t,o){r.onerror=r.onload=null,clearTimeout(m);var i=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach(function(e){return e(o)}),t)return t(o)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/utopia-things-editor/"}(),function(){var e={3524:0};o.f.j=function(t,n){var i=o.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var s=new Promise(function(o,n){i=e[t]=[o,n]});n.push(i[2]=s);var a=o.p+o.u(t),r=new Error,l=function(n){if(o.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var s=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",r.name="ChunkLoadError",r.type=s,r.request=a,i[1](r)}};o.l(a,l,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,s,a=n[0],r=n[1],l=n[2],c=0;if(a.some(function(t){return 0!==e[t]})){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)s=a[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(d)},n=self["webpackChunkthings_editor"]=self["webpackChunkthings_editor"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],function(){return o(3225)});n=o.O(n)})();
//# sourceMappingURL=app.08322be3.js.map